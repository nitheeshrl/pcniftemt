<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>

</head>
<body>
  <div id="status">&nbsp;</div>
  <h1 id="progress">&nbsp;</h1>
  <img id="img" />
</body>
<script>
  //fetch('https://fetch-progress.anthum.com/30kbps/images/sunrise-baseline.jpg')
  const elStatus = document.getElementById('status');
function status(text) {
  elStatus.innerHTML = text;
}

const elProgress = document.getElementById('progress');
function progress({loaded, total}) {
  elProgress.innerHTML = Math.round(loaded/total*100)+'%';
}

async function main() {
  status('downloading with fetch()...');
  const response = await fetch('https://passkey-5ev6.onrender.com');
  const contentLength = response.headers.get('content-length');
  const total = parseInt(contentLength, 10);
  const values = []
  let loaded = 0;

  const reader = response.body.getReader();
  while (true) {
    const {done, value} = await reader.read();
    if (done) break;
    values.push(value)
    loaded += value.byteLength;
    progress({loaded, total})
  }
  
  const blob = new Blob(values);
  status('download completed')
  document.getElementById('img').src = URL.createObjectURL(blob);
}

main();
</script>
</html>