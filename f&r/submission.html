<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="widthdevice-width, initial-scale=1">
    <link rel="icon" href="white_logo.png" type="image/x-icon">
    <title>Successfully Requested</title>  
    <link rel="stylesheet" href="style.css" />

</head>    
<body>
    <script>
      var fetchurl ="";
      var reno = sessionStorage.getItem("reno");
      console.log(reno);
      var renoval = Number( reno) +1;
      console.log(renoval);
      function getOrdinal(n) {
  let ord = 'th';

  if (n % 10 == 1 && n % 100 != 11)
  {
    ord = 'st';
  }
  else if (n % 10 == 2 && n % 100 != 12)
  {
    ord = 'nd';
  }
  else if (n % 10 == 3 && n % 100 != 13)
  {
    ord = 'rd';
  }

  return ord;
}
var ordd = getOrdinal(renoval)
var renonam = renoval + ordd;
        var name = sessionStorage.getItem("name");
        var reid = sessionStorage.getItem("reid");
        var ui ="";
        var uids = [
    "398",
    "756",
    "652",
    "235",
    "453",
   "648",
    "378",
    "345",
    "904",
    "413",
    "254",
    "890"
];
var inames = [
'Anandha Keerthy M',
'Anindit Bizy Nair',
'David Evander Jebson S',
'Keerthika P',
'Nitheesh R L',
'Shivam Jha',
'Srinithi C P',
'Subbu Krishna Sharma GM ',
'Yuvashreekantham R',
'R B Ramyaa',
'Anjali S',
'Mathangi G'
]
var iurls = [
'https://script.google.com/macros/s/AKfycbyY5uJMDnishBzf6icu-_OVAdKQiBhT2oV_WoGmfBSzjqH8dxAqT2kGNwZMR9RjsJY/exec',
'https://script.google.com/macros/s/AKfycbyZKQVXi8TkdKoG4qonwJA0PJdCMZ5Ib_ns4IEedhHguTDzwQmKzxdOXSqo295GXWA/exec',
'https://script.google.com/macros/s/AKfycbxVcuWPUCFCpukyGyoresI-2qUf9Va9G-I6ha2swlVrjS0BBo_gW9IvmBJdc1lqazbBDw/exec',
'https://script.google.com/macros/s/AKfycbxBwZInWnCaXIMELyDTWA-SSMkknn3ek_SmOAxrtDfRkb-3gYstXOS4x0JqokC34gqh/exec',
'https://script.google.com/macros/s/AKfycbzQT8-vjtlzR-5wPvtRNGjCEUqIzZoQgmRH9qq4hQckYeZTX3hyVMvI159mOyV4-O81ZQ/exec',
'https://script.google.com/macros/s/AKfycbwAcd8Ui8cA44t0qOns64CbAwF61MxRYwIsLNIWsqhPCR2_6eE8e66DFgtVSsYDdEp4/exec',
'https://script.google.com/macros/s/AKfycbzoI0pbzFUzkxfHHrCsP2YPAmQ0netELz8LmwHGXcDhWyTKJ5xaGDCzoHAx77TBWYs8/exec',
'https://script.google.com/macros/s/AKfycbyqlpVoPnFFW9_dK-8xlAOroB1CJvCjvm9NBoszdKF23lMV8mAFAwC7rtLlnbPwTj9IAQ/exec',
'https://script.google.com/macros/s/AKfycbyfTA3cWB77lQjKOgW32OwbYhfJU3m3mqj9TL8POpAlSW777Kcm_t_C_HYJpyTfQcsD8g/exec'
    ]
for (var i = 0; i < uids.length; i++) {

  if (name == inames[i]){
ui = uids[i];
fetchurl = iurls[i];
  }
  console.log(fetchurl)
}
        
        var rname = sessionStorage.getItem("rname");
        console.log(ui)
        console.log(formDataString)
    </script>
<section class="header1">
<div>
<img src="white_logo.png" alt="">
</div>
<div>
<h1>NIFTEM-T Placement Cell</h1>
</div>
</section>
<section class="msg" >

    <h1 style="text-align: center;">Successfully Requested</h1>
    <div   id="dfiled" style="align-content:normal; margin-left: 0px;margin-right: auto; margin-top: 30px;"><p style="text-align: left;">
        <div ></div> <span id = "status"></span><br><br><span id = "status2"></span> </p></div>

        <div id="load" class="load" > 
            <div class="loader" id="loader"> 
          
              </div> 
              <div
                id="message"
              class="message"
              style="width: 350px;"
                ></div>
            </div> 


</section>
<script>
  
  var stat = sessionStorage.getItem("stat");

    var status = document.getElementById("status");
    console.log(status)
    document.getElementById("status").innerHTML = "<span>The details are submitted to your alloted member: "+name+" for the verfiction.<br> <br> Once, it is approved or declined you will the mail. So, kindly check your mail. <br> <br> The Request ID is <b>"+reid+"</b><br><br> Use this ID for checking status.<br> <br>This is "+renonam+" request today. Only 5 requests are allowed per day.</span>";
    console.log("start")
    if (stat !=="sent"){
    document.getElementById("load").style.display="initial";
        document.getElementById("loader").style.display="block"; 
        document.getElementById("message").textContent = "Sending Mail to "+name+"...";
        
        
          console.log("in")
          var uilink = "https://niftemt-placementcell-forms.pages.dev/B2K21%20Brochure%20Details%20Update/?ui="+ui;
          var formDataString = name+"/valls/"+rname+"/valls/"+reid+"/valls/"+uilink;
          console.log(formDataString)
         
fetch(
 
              fetchurl,
              {
                redirect: "follow",
                method: "POST",
                body: formDataString,
                headers: {
                  "Content-Type": "text/plain;charset=utf-8",
                },
              }
            )
    
              .then(function (response) {
    
                // Check if the request was successful
                if (response) {
             
                  return response; // Assuming your script returns JSON response
                } else {
                  throw new Error("Failed to send the mail. Inform your alloted member to review your request");
                }
              })
              .then(async function (data) {
        const result1 = await data.json();
  
        var r = result1.data2;
console.log(r);
if(r == "sent"){
    document.getElementById("loader").style.display="none"; 
                document.getElementById("message").textContent =
                 "Mail Sent to "+name;
                document.getElementById("message").style.display = "block";
                setTimeout(function () { document.getElementById("load").style.display="none"; },2000);
                document.getElementById("status2").textContent = "Mail Sent to "+name;
                sessionStorage.setItem("stat","sent");
}


      })

      .catch(function (error) {
        // Handle errors, you can display an error message here
        console.error(error);
        document.getElementById("loader").style.display="none"; 
        document.getElementById("message").innerHTML =
          "Failed to Send the Mail. <br>Inform your alloted member to review your request";
          setTimeout(function () { document.getElementById("load").style.display="none"; },2000);
          document.getElementById("status2").textContent = "Failed to Send the Mail. Inform your alloted member to review your request";
        document.getElementById("message").style.display = "block";
      });
    }
             
</script>
</body>
</html>